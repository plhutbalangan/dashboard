<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Data Haji Balangan</title>
  <link href="style.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <header>
      <h1>📊 Dashboard Data Haji Kabupaten Balangan</h1>
      <p id="update-info">Memuat data...</p>
    </header>

    <section class="cards">
      <div class="card">
        <h2>Jumlah Jemaah</h2>
        <p id="jumlah_jemaah">...</p>
      </div>

      <div class="card">
        <h2>Lansia</h2>
        <p id="lansia">...</p>
      </div>

      <!-- 🔁 Kolom baru: Masa Tunggu -->
      <div class="card">
        <h2>Masa Tunggu</h2>
        <p id="masa_tunggu">...</p>
      </div>
    </section>

    <section class="charts">
      <div class="chart-container">
        <h3>Pendidikan Jemaah</h3>
        <canvas id="chartPendidikan"></canvas>
      </div>
      <div class="chart-container">
        <h3>Pekerjaan Jemaah</h3>
        <canvas id="chartPekerjaan"></canvas>
      </div>
      <div class="chart-container">
        <h3>Kelompok Umur</h3>
        <canvas id="chartUmur"></canvas>
      </div>
    </section>

    <footer>
      <p>Data sumber: <strong>SISKOHAT Kemenag RI</strong> | Otomatis diperbarui lokal setiap startup</p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  async function loadData() {
    try {
      const response = await fetch("static/data_balangan.json");
      const jsonData = await response.json();

      // Tanggal update
      document.getElementById("update-info").innerText = 
        "Diperbarui: " + jsonData.update;

      // Data utama
      document.getElementById("jumlah_jemaah").innerText =
        jsonData.data.Jumlah_Jemaah.data.rows[0][0].toLocaleString("id-ID");

      document.getElementById("lansia").innerText =
        jsonData.data.Lansia.data.rows[0][0].toLocaleString("id-ID");

      // 🔁 Data Masa Tunggu
      const tunggu = jsonData.data.Masa_Tunggu.data.rows[0][0];
      document.getElementById("masa_tunggu").innerText = tunggu + " Tahun";

      // Chart Pendidikan
      const pendidikan = jsonData.data.Pekerjaan.data.rows;
      new Chart(document.getElementById("chartPendidikan"), {
        type: "bar",
        data: {
          labels: pendidikan.map(r => r[0]),
          datasets: [{
            label: "Jumlah Jemaah",
            data: pendidikan.map(r => r[1])
          }]
        }
      });

      // Chart Pekerjaan
      const kerja = jsonData.data.Jenis_Kelamin.data.rows;
      new Chart(document.getElementById("chartPekerjaan"), {
        type: "pie",
        data: {
          labels: kerja.map(r => r[0]),
          datasets: [{
            label: "Jumlah Jemaah",
            data: kerja.map(r => r[1])
          }]
        }
      });

      // Chart Umur
      const umur = jsonData.data.Kelompok_Umur.data.rows;
      new Chart(document.getElementById("chartUmur"), {
        type: "line",
        data: {
          labels: umur.map(r => r[0] + " thn"),
          datasets: [{
            label: "Jumlah Jemaah",
            data: umur.map(r => r[1])
          }]
        }
      });

    } catch (error) {
      document.getElementById("update-info").innerText = "Gagal memuat data.";
      console.error("Error:", error);
    }
  }

  loadData();
  </script>
</body>
</html>
